<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<CompositionRulesConfiguration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xsi:noNamespaceSchemaLocation="compositionRules.xsd" >
    
    <MetricsCompositionRules>
    
        <CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT">
            
            <ResultingMetric type="RESOURCE" measurementUnit="%" name="cpuUsage"/>
            <Operation value="100" type="ADD">
                  <Operation value="-1" type="MUL">
                         <Operation MetricSourceMonitoredElementLevel="VM" type="AVG">
                   		 <ReferenceMetric type="RESOURCE" measurementUnit="%"  name="cpuIdle"/>
                </Operation>
            </Operation>
            </Operation>
        </CompositionRule>

       
        <CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT">
            
            <ResultingMetric type="RESOURCE" measurementUnit="%" name="memUsedPercent"/>
            <Operation MetricSourceMonitoredElementLevel="VM" type="AVG">
                <ReferenceMetric type="RESOURCE" name="memUsedPercent"/>
            </Operation>
        </CompositionRule>

        <CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT">
            
            <ResultingMetric type="RESOURCE" measurementUnit="%" name="memUsedPercent"/>
            <Operation MetricSourceMonitoredElementLevel="VM" type="AVG">
                <ReferenceMetric type="RESOURCE" name="memUsedPercent"/>
            </Operation>
        </CompositionRule>


         <CompositionRule TargetMonitoredElementLevel="VM">
            
            <ResultingMetric type="RESOURCE" measurementUnit="MB/s" name="dataTransfer"/>
            <Operation type="DIV" value="1048576">
                <Operation MetricSourceMonitoredElementLevel="VM" type="SUM">
                    <Operation MetricSourceMonitoredElementLevel="VM" type="SUM">
                        <ReferenceMetric type="RESOURCE" name="netBytesIN" />
                    </Operation>
                    <Operation MetricSourceMonitoredElementLevel="VM" type="SUM">
                        <ReferenceMetric type="RESOURCE" name="netBytesOUT" />
                    </Operation>
                </Operation>
            </Operation>
        </CompositionRule>

<CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT">
            
            <ResultingMetric type="RESOURCE" measurementUnit="#" name="activeSessions"/>
            <Operation MetricSourceMonitoredElementLevel="VM" type="SUM">
                <ReferenceMetric type="RESOURCE" name="activeSessions"/>
            </Operation>
        </CompositionRule>

 
        <CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT">
            
            <ResultingMetric type="RESOURCE" measurementUnit="ms" name="avgResponseTime"/>
            <Operation MetricSourceMonitoredElementLevel="VM" type="AVG">
                <ReferenceMetric type="RESOURCE" name="avgResponseTime"/>
            </Operation>
        </CompositionRule>

 	
        <CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT">
            
            <ResultingMetric type="RESOURCE" measurementUnit="req/s" name="requestRate"/>
            <Operation MetricSourceMonitoredElementLevel="VM" type="SUM">
                <ReferenceMetric type="RESOURCE" name="requestRate"/>
            </Operation>
        </CompositionRule>



        <CompositionRule TargetMonitoredElementLevel="SERVICE">
            
               <ResultingMetric type="RESOURCE" measurementUnit="MB/s" name="dataTransfer"/>
               
                <Operation MetricSourceMonitoredElementLevel="VM" type="SUM">
				 
					<ReferenceMetric type="RESOURCE" name="dataTransfer" />
 

			</Operation>
         
        </CompositionRule>
	
 
            
        <CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT">
            
            <ResultingMetric type="RESOURCE" measurementUnit="ms" name="responseTime"/>
            <Operation MetricSourceMonitoredElementLevel="VM" type="AVG">
                <ReferenceMetric type="RESOURCE" name="responseTime"/>
            </Operation>
        </CompositionRule>
 
 
        
         <CompositionRule TargetMonitoredElementLevel="SERVICE_TOPOLOGY">
             
            <ResultingMetric type="QUALITY" measurementUnit="ms" name="latency"/>
            <Operation MetricSourceMonitoredElementLevel="SERVICE_UNIT" type="KEEP">
                <ReferenceMetric type="QUALITY" measurementUnit="ms" name="latency"/>
            </Operation>
        </CompositionRule>
         <CompositionRule TargetMonitoredElementLevel="SERVICE_TOPOLOGY">
             
            <ResultingMetric type="RESOURCE" measurementUnit="%" name="cpuUsage"/>
            <Operation MetricSourceMonitoredElementLevel="SERVICE_UNIT" type="AVG">
                <ReferenceMetric type="RESOURCE" measurementUnit="%" name="cpuUsage"/>
            </Operation>
        </CompositionRule>
        <CompositionRule TargetMonitoredElementLevel="SERVICE_TOPOLOGY">
           
            <ResultingMetric type="RESOURCE" measurementUnit="ms" name="responseTime"/>
            <Operation MetricSourceMonitoredElementLevel="SERVICE_UNIT" type="AVG">
                <ReferenceMetric type="RESOURCE" name="responseTime"/>
                 
            </Operation>
        </CompositionRule>
        <CompositionRule TargetMonitoredElementLevel="SERVICE_TOPOLOGY">
             
            <ResultingMetric type="RESOURCE" measurementUnit="operations/s" name="throughput"/>
            <Operation MetricSourceMonitoredElementLevel="SERVICE_UNIT" type="SUM">
                <ReferenceMetric type="RESOURCE" name="throughput"/>
                 
            </Operation>
        </CompositionRule>

    <CompositionRule TargetMonitoredElementLevel="VM">
            <ResultingMetric type="RESOURCE" measurementUnit="ms" name="numberOfVMs"/>
            <Operation value="1" type="SET_VALUE"/>
        </CompositionRule>

 
        <CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT">
            <ResultingMetric type="RESOURCE" measurementUnit="ms" name="instances"/>
            <Operation MetricSourceMonitoredElementLevel="VM" type="SUM">
                <ReferenceMetric type="RESOURCE" name="numberOfVMs"/>
            </Operation>
        </CompositionRule>


        <CompositionRule TargetMonitoredElementLevel="SERVICE">
            <ResultingMetric type="RESOURCE" measurementUnit="ms" name="vmsUsed"/>
            <Operation MetricSourceMonitoredElementLevel="SERVICE_UNIT" type="SUM">
                <ReferenceMetric type="RESOURCE" name="instances"/>
            </Operation>
        </CompositionRule>
 
        

    </MetricsCompositionRules>
     
</CompositionRulesConfiguration>
